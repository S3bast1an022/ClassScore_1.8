<!DOCTYPE html>
<!--
  ================================================================
  ARCHIVO: panelAdmin.html
  DESCRIPCIÓN:
    Panel principal del administrador en el sistema ClassScore.
    Permite gestionar usuarios, cursos, horarios, comunicados y
    el perfil del administrador. Incluye navegación por pestañas
    y secciones dinámicas que se cargan según la selección del usuario.
  ================================================================
-->
<html lang="es">
<head>
  <meta charset="UTF-8">  <!-- Codificación UTF-8 para caracteres especiales -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">  <!-- Responsive design -->
  <title>Bienvenido — Class Score</title>
  <!-- Estilos CSS del sistema -->
  <link rel="stylesheet" href="../classScore/classscore.css">
</head>

<body class="panel-admin">
  <!-- ================================================================
       ENCABEZADO PRINCIPAL DEL PANEL
       Contiene el logo, el título del sistema y el botón de cerrar sesión.
  ================================================================= -->
  <header>
    <div class="header-left">
      <!-- Contenedor del logo con fondo blanco para que resalte -->
      <div class="logo-container-header">
        <img src="./imagenes_de_pagina/logo-cs.png" alt="Logo del sistema" class="logo-img">
      </div>
      <!-- Título dinámico que se actualizará con el nombre del usuario -->
      <h1 id="header-titulo">Bienvenido, Usuario</h1>
    </div>
    <button class="logout-btn" onclick="cerrarSesion()">Cerrar sesión</button>
  </header>

  <!-- ================================================================
       CONTENEDOR GENERAL
       Aquí se agrupan las tarjetas de acceso y las secciones principales.
  ================================================================= -->
  <div class="container">

    <!-- ================================================================
         MENÚ DE PESTAÑAS DE NAVEGACIÓN
         Permite cambiar entre las secciones sin recargar la página.
         NOTA: Ninguna pestaña está activa por defecto para evitar que
         se muestre automáticamente ninguna sección al cargar la página.
    ================================================================= -->
    <!-- Mapa de navegación (solo indicador visual, no clickeable) -->
    <!-- Muestra en qué sección se encuentra el usuario actualmente -->
    <div class="nav-tabs" id="nav-tabs-indicador">
      <div class="tab-indicador" data-seccion="usuarios">Usuarios</div>
      <div class="tab-indicador" data-seccion="cursos">Cursos</div>
      <div class="tab-indicador" data-seccion="horarios">Horarios</div>
      <div class="tab-indicador" data-seccion="comunicados">Comunicados</div>
      <div class="tab-indicador" data-seccion="perfil">Perfil</div>
    </div>

    <!-- ================================================================
         BLOQUE DE TARJETAS PRINCIPALES
         Permite navegar rápidamente hacia las secciones del sistema.
    ================================================================= -->
    <div class="cards">
      <div class="card">
        <h2>Usuarios</h2>
        <p>Gestiona docentes y estudiantes.</p>
        <a href="#" class="btn" onclick="mostrarSeccion('usuarios'); cargarUsuarios();">Ir</a>
      </div>

      <div class="card">
        <h2>Cursos</h2>
        <p>Administra grupos y asignaturas.</p>
        <a href="#" class="btn" onclick="mostrarSeccion('cursos')">Ir</a>
      </div>

      <div class="card">
        <h2>Horarios</h2>
        <p>Consulta y gestiona horarios de docentes.</p>
        <a href="#" class="btn" onclick="mostrarSeccion('horarios'); cargarHorariosAdmin();">Ir</a>
      </div>

      <div class="card">
        <h2>Comunicados</h2>
        <p>Publica y gestiona comunicados.</p>
        <a href="#" class="btn" onclick="mostrarSeccion('comunicados'); cargarComunicadosAdmin();">Ir</a>
      </div>

      <div class="card">
        <h2>Perfil</h2>
        <p>Edita tu información y preferencias.</p>
        <a href="#" class="btn" onclick="mostrarSeccion('perfil')">Ir</a>
      </div>
    </div>

    <!-- ================================================================
         SECCIÓN: USUARIOS
         Permite registrar, listar y eliminar usuarios del sistema.
    ================================================================= -->
    <section id="usuarios" class="seccion oculto">
      <h2>Gestión de Usuarios</h2>

      <!-- FORMULARIO DE REGISTRO -->
      <div class="form-container">
        <h3>Registrar nuevo usuario</h3>

        <form id="form-usuario" onsubmit="crearUsuario(event)">
          <label for="nombre">Nombre completo:</label>
          <input type="text" id="nombre" name="nombre" placeholder="Ej: Juan Pérez" required>
          <span id="error-nombre" class="error-message"></span>

          <label for="correo">Correo electrónico:</label>
          <input type="email" id="correo" name="correo" placeholder="Ej: juan@email.com" required>
          <span id="error-correo" class="error-message"></span>

          <label for="password">Contraseña:</label>
          <input type="password" id="password" name="password" placeholder="Ingrese una contraseña segura" minlength="6" required>
          <span id="error-password" class="error-message"></span>

          <label for="tipo_documento">Tipo de documento:</label>
          <select id="tipo_documento" name="tipo_documento" required>
            <option value="">Seleccione...</option>
            <option value="Cédula">Cédula</option>
            <option value="Tarjeta de identidad">Tarjeta de identidad</option>
            <option value="Pasaporte">Pasaporte</option>
            <option value="NIT">NIT</option>
            <option value="Cédula de extranjería">Cédula de extranjería</option>
          </select>
          <span id="error-tipo-documento" class="error-message"></span>

          <label for="numero_documento">Número de documento:</label>
          <input type="text" id="numero_documento" name="numero_documento" placeholder="Solo números (ej: 1234567890)" pattern="[0-9]+" required>
          <span id="error-numero-documento" class="error-message"></span>

          <label for="rol">Tipo de usuario:</label>
          <select id="rol" name="rol" required>
            <option value="">Seleccione...</option>
            <option value="Docente">Docente</option>
            <option value="Estudiante">Estudiante</option>
            <option value="Administrador">Administrador</option>
          </select>
          <span id="error-rol" class="error-message"></span>

          <!-- Campo visible solo si el rol es "Docente" -->
          <div id="campo-materia" class="oculto">
            <label for="materia">Asignatura:</label>
            <select id="materia" name="materia">
              <option value="">Seleccione...</option>
              <option value="1">Arte</option>
              <option value="2">Biología</option>
              <option value="3">Ciencias Naturales</option>
              <option value="4">Ciencias Sociales</option>
              <option value="5">Educación Ambiental</option>
              <option value="6">Educación Física</option>
              <option value="7">Emprendimiento</option>
              <option value="8">Español</option>
              <option value="9">Ética y Valores</option>
              <option value="10">Filosofía</option>
              <option value="11">Física</option>
              <option value="12">Geografía</option>
              <option value="13">Historia</option>
              <option value="14">Inglés</option>
              <option value="15">Lectura Crítica</option>
              <option value="16">Matemáticas</option>
              <option value="17">Música</option>
              <option value="18">Química</option>
              <option value="19">Religión</option>
              <option value="20">Tecnología e Informática</option>
            </select>
          </div>

          <button type="submit" class="user-btn">Registrar</button>
        </form>
      </div>

      <hr>

      <!-- TABLA DE USUARIOS ACTIVOS -->
      <div class="tabla-container">
        <h3>Usuarios activos</h3>

        <table id="tabla-usuarios">
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Correo</th>
              <th>Rol</th>
              <th>Tipo Documento</th>
              <th>Número Documento</th>
              <th>Salón / Materias</th>
              <th>Seleccionar</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <button onclick="borrarSeleccionados()" class="user-btn eliminar">Borrar seleccionados</button>

    </section>


    <!-- ================================================================
     SECCIÓN: CURSOS
     Permite registrar nuevos cursos y visualizar los existentes.
    ================================================================= -->
    
    <section id="cursos" class="seccion oculto">
      <h2>Gestión de Cursos</h2>
      
      <!-- FORMULARIO PARA CREAR NUEVOS CURSOS -->
      <div class="form-container">
        <h3>Registrar nuevo curso</h3>
        <form id="form-curso" onsubmit="crearCurso(event)">
          <label for="nombre_curso">Nombre del curso:</label>
          <input type="text" id="nombre_curso" name="nombre_curso" placeholder="Ej: 702 o 9A" required>

          <label for="descripcion">Descripción</label>
          <input type="text" id="descripcion" name="descripcion" placeholder="Ej: Curso de grado séptimo" required>

          <button type="submit" class="user-btn">Registrar Curso</button>
        </form>
      </div>

      <hr>

      <!-- LISTADO DE CURSOS EXISTENTES -->
      <div class="tabla-container">
        <h3>Cursos registrados</h3>

        <!-- Aquí se mostrarán los cursos como botones dinámicos -->
        <div id="contenedor-cursos" class="grid-cursos"></div>
        
        <!-- Contenedor para la tabla de estudiantes del curso (inicialmente oculto) -->
        <div id="tabla-estudiantes-curso-container" class="oculto" style="margin-top: 30px;">
          <h3>Estudiantes registrados en el curso</h3>
          
          <div class="tabla-container">
            <table id="tabla-estudiantes-curso" style="width: 100%;">
              <thead>
                <tr>
                  <th>Nombre</th>
                  <th>Tipo de documento</th>
                  <th>Número de documento</th>
                </tr>
              </thead>
              <tbody id="tbody-estudiantes-curso">
                <!-- Estudiantes cargados dinámicamente -->
              </tbody>
            </table>
          </div>
          
          <div style="margin-top: 20px; text-align: center;">
            <button type="button" id="btn-registrar-estudiantes" class="user-btn" onclick="mostrarTablaInscripcion()">
              Registrar estudiantes
            </button>
            <button type="button" class="user-btn secondary" onclick="volverAListaCursos()" style="margin-left: 10px;">
              Volver
            </button>
          </div>
        </div>
        
        <!-- Contenedor para la tabla de inscripción de estudiantes (inicialmente oculto) -->
        <div id="tabla-inscripcion-container" class="oculto" style="margin-top: 30px;">
          <h3>Inscribir estudiantes en el curso</h3>
          
          <div id="mensaje-inscripcion" class="alert" style="display:none; margin-bottom: 15px;"></div>
          
          <div class="tabla-container">
            <table id="tabla-inscripcion-estudiantes" style="width: 100%;">
              <thead>
                <tr>
                  <th style="width: 50px; text-align: center;">Seleccionar</th>
                  <th>Nombre</th>
                  <th>Tipo de documento</th>
                  <th>Número de documento</th>
                </tr>
              </thead>
              <tbody id="tbody-inscripcion-estudiantes">
                <!-- Estudiantes cargados dinámicamente -->
              </tbody>
            </table>
          </div>
          
          <div style="margin-top: 20px; text-align: center;">
            <button type="button" id="btn-inscribir-estudiantes" class="user-btn" onclick="inscribirEstudiantesSeleccionados()">
              Inscribir
            </button>
            <button type="button" class="user-btn secondary" onclick="ocultarTablaInscripcion()" style="margin-left: 10px;">
              Cancelar
            </button>
          </div>
        </div>
      </div>

    </section>

    <!-- ================================================================
         SECCIÓN: HORARIOS
         Permite asignar horarios a profesores y consultar horarios.
    ================================================================= -->
    <section id="horarios" class="seccion oculto">
      <h2>Gestión de Horarios</h2>
      
      <!-- FORMULARIO PARA ASIGNAR HORARIOS A PROFESORES -->
      <div class="form-container">
        <h3>Asignar horario a profesor</h3>
        <form id="form-horario" onsubmit="guardarHorario(event)">
          <label for="horario-docente">Profesor:</label>
          <select id="horario-docente" required>
            <option value="">Seleccione un profesor...</option>
            <!-- Opciones cargadas dinámicamente -->
          </select>

          <label for="horario-curso">Curso (Salón):</label>
          <select id="horario-curso" required>
            <option value="">Seleccione un curso...</option>
            <!-- Opciones cargadas dinámicamente -->
          </select>

          <label for="horario-dia">Día de la semana:</label>
          <select id="horario-dia" required>
            <option value="">Seleccione...</option>
            <option value="1">Lunes</option>
            <option value="2">Martes</option>
            <option value="3">Miércoles</option>
            <option value="4">Jueves</option>
            <option value="5">Viernes</option>
            <option value="6">Sábado</option>
            <option value="7">Domingo</option>
          </select>

          <label for="horario-inicio">Hora inicio:</label>
          <input type="time" id="horario-inicio" required>

          <label for="horario-fin">Hora fin:</label>
          <input type="time" id="horario-fin" required>

          <button type="submit" class="user-btn">Guardar horario</button>
        </form>
        
        <div id="mensaje-horario" class="alert" style="display:none; margin-top: 15px;"></div>
      </div>

      <hr>

      <!-- FILTRO Y TABLA DE HORARIOS POR PROFESOR -->
      <div class="tabla-container" style="margin-top: 30px;">
        <h3>Horarios por profesor</h3>
        
        <div style="margin-bottom: 15px;">
          <label for="filtro-docente-horarios">Filtrar por profesor:</label>
          <select id="filtro-docente-horarios" onchange="cargarHorariosPorProfesor()" style="width: 300px; padding: 8px;">
            <option value="">Seleccione un profesor...</option>
            <!-- Opciones cargadas dinámicamente -->
          </select>
        </div>

        <table id="tabla-horarios-profesor" style="width: 100%;">
          <thead>
            <tr>
              <th>Día</th>
              <th>Hora inicio</th>
              <th>Hora fin</th>
              <th>Salón (Curso)</th>
            </tr>
          </thead>
          <tbody id="tbody-horarios-profesor">
            <tr>
              <td colspan="4" style="text-align: center; padding: 20px;">
                Seleccione un profesor para ver su horario.
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <hr>

      <!-- FILTRO Y TABLA DE HORARIOS POR CURSO -->
      <div class="tabla-container" style="margin-top: 30px;">
        <h3>Horarios por curso</h3>
        
        <div style="margin-bottom: 15px;">
          <label for="filtro-curso-horarios">Filtrar por curso:</label>
          <select id="filtro-curso-horarios" onchange="cargarHorariosPorCurso()" style="width: 300px; padding: 8px;">
            <option value="">Seleccione un curso...</option>
            <!-- Opciones cargadas dinámicamente -->
          </select>
        </div>

        <table id="tabla-horarios-curso" style="width: 100%;">
          <thead>
            <tr>
              <th>Materia</th>
              <th>Profesor</th>
              <th>Día</th>
              <th>Hora inicio</th>
              <th>Hora fin</th>
            </tr>
          </thead>
          <tbody id="tbody-horarios-curso">
            <tr>
              <td colspan="5" style="text-align: center; padding: 20px;">
                Seleccione un curso para ver su horario.
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- ================================================================
         SECCIÓN: COMUNICADOS
         Permite publicar y gestionar comunicados.
    ================================================================= -->
    <section id="comunicados" class="seccion oculto">
      <h2>Gestión de Comunicados</h2>
      <p class="helper">Publica y gestiona comunicados para estudiantes y docentes.</p>

      <div style="margin-bottom:20px;">
        <button type="button" class="user-btn" onclick="abrirModalCrearComunicado()">
          + Publicar nuevo comunicado
        </button>
      </div>

      <div id="mensaje-comunicados-admin" class="alert" style="display:none;"></div>

      <div class="tabla-container">
        <table id="tabla-comunicados-admin">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Título</th>
              <th>Contenido</th>
              <th>Autor</th>
              <th>Cargo</th>
            </tr>
          </thead>
          <tbody id="tbody-comunicados-admin">
            <!-- Filas cargadas dinámicamente -->
          </tbody>
        </table>
      </div>
    </section>


    <!-- Modal para crear comunicado -->
    <div id="modal-crear-comunicado" class="modal oculto">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Publicar nuevo comunicado</h3>
          <span class="modal-close" onclick="cerrarModalCrearComunicado()">&times;</span>
        </div>
        <div class="modal-body">
        <form id="form-comunicado" class="form-perfil">
          <label for="comunicado-titulo">Título:</label>
          <input type="text" id="comunicado-titulo" placeholder="Título del comunicado" required>

          <label for="comunicado-contenido">Contenido:</label>
          <textarea id="comunicado-contenido" rows="5" placeholder="Contenido del comunicado" required></textarea>

          <button type="button" class="user-btn" onclick="guardarComunicado()">Publicar comunicado</button>
          <button type="button" class="user-btn secondary" onclick="cerrarModalCrearComunicado()">Cancelar</button>
        </form>
        </div>
      </div>
    </div>

    <!-- ================================================================
         SECCIÓN: PERFIL
         Permite editar información personal, subir foto de perfil
         y cambiar contraseña.
    ================================================================= -->
    <section id="perfil" class="seccion oculto">
      <h2>Perfil del Administrador</h2>
      
      <!-- Contenedor principal del perfil -->
      <div id="contenedor-perfil" class="perfil-container">
        
        <!-- Sección de foto de perfil -->
        <div class="perfil-foto-container">
          <div class="foto-wrapper">
            <img id="foto-perfil" src="./imagenes_de_pagina/sin_foto_perfil.jpeg" alt="Foto de perfil" class="foto-perfil">
            <div class="foto-overlay">
              <button type="button" class="btn-cambiar-foto" onclick="abrirModalFoto()">Modificar foto de perfil</button>
            </div>
          </div>
        </div>

        <!-- Sección de información personal -->
        <div class="perfil-info-container">
          <div class="perfil-header">
            <h3>Información personal</h3>
            <button type="button" class="user-btn" id="btn-editar-perfil" onclick="toggleEditarPerfil()">Editar</button>
          </div>

          <div id="mensaje-perfil" class="alert" style="display:none;"></div>

          <form id="form-perfil" class="form-perfil">
            <label for="perfil-nombre">Nombre completo:</label>
            <input type="text" id="perfil-nombre" name="nombre" readonly>

            <label for="perfil-correo">Correo electrónico:</label>
            <input type="email" id="perfil-correo" name="correo" readonly>

            <label for="perfil-telefono">Teléfono:</label>
            <input type="text" id="perfil-telefono" name="telefono" placeholder="Ej: +57 311 555 1234" readonly>

            <label for="perfil-cargo">Cargo:</label>
            <input type="text" id="perfil-cargo" name="cargo" placeholder="Ej: Rector, Coordinador académico" readonly>

            <label for="perfil-tipo-documento">Tipo de documento:</label>
            <select id="perfil-tipo-documento" name="tipo_documento" disabled>
              <option value="">Seleccione...</option>
              <option value="Cédula">Cédula</option>
              <option value="Tarjeta de identidad">Tarjeta de identidad</option>
              <option value="Pasaporte">Pasaporte</option>
              <option value="NIT">NIT</option>
              <option value="Cédula de extranjería">Cédula de extranjería</option>
            </select>

            <label for="perfil-numero-documento">Número de documento:</label>
            <input type="text" id="perfil-numero-documento" name="numero_documento" pattern="[0-9]+" placeholder="Solo números" readonly>

            <button type="button" class="user-btn" id="btn-actualizar-perfil" onclick="actualizarPerfil()" style="display:none; margin-top:15px;">Actualizar perfil</button>
          </form>
        </div>

        <!-- Sección de cambio de contraseña -->
        <div class="perfil-password-container">
          <h3>Actualizar contraseña</h3>
          <div id="mensaje-password" class="alert" style="display:none;"></div>

          <form id="form-password" class="form-perfil">
            <label for="password-actual">Contraseña actual:</label>
            <div class="password-input-wrapper">
              <input type="password" id="password-actual" name="password_actual" placeholder="Ingrese su contraseña actual">
              <button type="button" class="toggle-password" onclick="togglePassword('password-actual')" aria-label="Mostrar contraseña">◉</button>
            </div>

            <label for="password-nueva">Nueva contraseña:</label>
            <div class="password-input-wrapper">
              <input type="password" id="password-nueva" name="password_nueva" placeholder="Mínimo 6 caracteres" minlength="6">
              <button type="button" class="toggle-password" onclick="togglePassword('password-nueva')" aria-label="Mostrar contraseña">◉</button>
            </div>

            <label for="password-confirmar">Confirmar nueva contraseña:</label>
            <div class="password-input-wrapper">
              <input type="password" id="password-confirmar" name="password_confirmar" placeholder="Confirme la nueva contraseña" minlength="6">
              <button type="button" class="toggle-password" onclick="togglePassword('password-confirmar')" aria-label="Mostrar contraseña">◉</button>
            </div>

            <button type="button" class="user-btn" onclick="actualizarPassword()" style="margin-top:15px;">Actualizar contraseña</button>
          </form>
        </div>

      </div>
    </section>

    <!-- Modal para subir foto de perfil -->
    <div id="modal-foto" class="modal oculto">
      <div class="modal-content">
        <span class="modal-close" onclick="cerrarModalFoto()">&times;</span>
        <h3>Cambiar foto de perfil</h3>
        <form id="form-foto" enctype="multipart/form-data">
          <input type="file" id="input-foto" name="foto" accept="image/jpeg,image/jpg,image/png" required>
          <div id="preview-foto" style="margin:15px 0; text-align:center;">
            <img id="img-preview" src="" alt="Vista previa" style="max-width:200px; max-height:200px; display:none; border-radius:8px;">
          </div>
          <button type="button" class="user-btn" onclick="subirFotoPerfil()">Subir foto</button>
          <button type="button" class="user-btn secondary" onclick="cerrarModalFoto()">Cancelar</button>
        </form>
      </div>
    </div>

  </div>

  <script src="admin.js" defer></script>
</body>
</html>
